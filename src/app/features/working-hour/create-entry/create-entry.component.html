<app-header titleInput="Eintrag anlegen"></app-header>

<div class="sub-nav row">
  <div class="col-10">
    <div type="button" class="nav-before-btn" (click)="navigateToOrderList()">
      <mat-icon>navigate_before</mat-icon>
    </div>
  </div>
  <div class="col-2">
    <div
      type="button"
      class="save-btn"
      (click)="documentCreateEntryForm.ngSubmit.emit()"
    >
      <mat-icon>save</mat-icon>
    </div>
  </div>
</div>

<div id="create-entry-component-wrapper" class="row no-gutter">
  <div class="col-12">
    <div id="create-entry-form-wrapper" class="row no-gutter">
      <div class="col-12">
        <form
          id="create-entry-form"
          formGroup="createEntryForm"
          #documentCreateEntryForm="ngForm"
          (ngSubmit)="onSubmit()"
        >
          <fieldset class="form-group">
            <mat-form-field appearance="fill">
              <mat-label>Kategorie auswählen</mat-label>
              <mat-select
                formControlName="category"
                [ngClass]="{
                  'is-invalid':
                    submitted && getEntryFormControls.category.errors
                }"
              >
                <mat-option
                  *ngFor="let category of categories"
                  [value]="category.value"
                >
                  {{ category.viewValue }}
                </mat-option>
              </mat-select>
              <div
                *ngIf="submitted && getEntryFormControls.category.errors"
                class="invalid-feedback"
              >
                <div *ngIf="getEntryFormControls.category.errors.required">
                  Bitte <strong>Kategorie</strong> auswählen
                </div>
              </div>
            </mat-form-field>
          </fieldset>
        </form>

        <div *ngIf="selectedCategory === eCategory.workingHours">
          <form
            id="working-hours-form"
            formGroup="workingHoursForm"
            #documentWorkingHoursForm="ngForm"
            (ngSubmit)="onSubmit()"
          >
            <fieldset class="form-group">
              <mat-form-field>
                <input
                  matInput
                  [matDatepicker]="picker"
                  placeholder="Datum wählen"
                  id="date"
                  name="date"
                  formControlName="date"
                  (click)="picker.open()"
                  required
                  [ngClass]="{
                    'is-invalid':
                      submitted && getWorkingHoursFormControls.date.errors
                  }"
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="picker"
                ></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
                <div
                  *ngIf="submitted && getWorkingHoursFormControls.date.errors"
                  class="invalid-feedback"
                >
                  <div *ngIf="getWorkingHoursFormControls.date.errors.required">
                    Bitte <strong>Datum</strong> eingeben
                  </div>
                </div>
              </mat-form-field>
            </fieldset>

            <fieldset class="form-group">
              <mat-form-field>
                <input
                  matInput
                  formControlName="description"
                  placeholder="Art der Arbeit"
                  required
                  [ngClass]="{
                    'is-invalid':
                      submitted &&
                      getWorkingHoursFormControls.description.errors
                  }"
                />
                <div
                  *ngIf="
                    submitted && getWorkingHoursFormControls.description.errors
                  "
                  class="invalid-feedback"
                >
                  <div
                    *ngIf="
                      getWorkingHoursFormControls.description.errors.required
                    "
                  >
                    Bitte <strong>Beschreibung</strong> eingeben
                  </div>
                </div>
              </mat-form-field>
            </fieldset>

            <fieldset class="form-group">
              <mat-form-field>
                <input
                  matInput
                  type="number"
                  formControlName="workingHours"
                  placeholder="Arbeitsstunden"
                  required
                  [ngClass]="{
                    'is-invalid':
                      submitted &&
                      getWorkingHoursFormControls.workingHours.errors
                  }"
                />
                <div
                  *ngIf="
                    submitted && getWorkingHoursFormControls.workingHours.errors
                  "
                  class="invalid-feedback"
                >
                  <div
                    *ngIf="
                      getWorkingHoursFormControls.workingHours.errors.required
                    "
                  >
                    Bitte <strong>Stunden</strong> eingeben
                  </div>
                </div>
              </mat-form-field>
            </fieldset>

            <fieldset class="form-group">
              <mat-form-field appearance="fill">
                <mat-label>Arbeiter auswählen</mat-label>
                <mat-select
                  formControlName="employee"
                  multiple
                  [ngClass]="{
                    'is-invalid':
                      submitted && getWorkingHoursFormControls.employee.errors
                  }"
                >
                  <mat-option
                    *ngFor="let employee of employees"
                    [value]="employee.value"
                  >
                    {{ employee.viewValue }}
                  </mat-option>
                </mat-select>
                <div
                  *ngIf="
                    submitted && getWorkingHoursFormControls.employee.errors
                  "
                  class="invalid-feedback"
                >
                  <div
                    *ngIf="getWorkingHoursFormControls.employee.errors.required"
                  >
                    Bitte <strong>Arbeiter</strong> auswählen
                  </div>
                </div>
              </mat-form-field>
            </fieldset>
          </form>
        </div>

        <div *ngIf="selectedCategory === eCategory.material">
          <form
            id="material-form"
            formGroup="materialForm"
            #documentMaterialForm="ngForm"
            (ngSubmit)="onSubmit()"
          >
            <fieldset class="form-group">
              <mat-form-field>
                <input
                  matInput
                  [matDatepicker]="picker"
                  placeholder="Datum wählen"
                  id="date"
                  name="date"
                  formControlName="date"
                  (click)="picker.open()"
                  required
                  [ngClass]="{
                    'is-invalid':
                      submitted && getMaterialFormControls.date.errors
                  }"
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="picker"
                ></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
                <div
                  *ngIf="submitted && getMaterialFormControls.date.errors"
                  class="invalid-feedback"
                >
                  <div *ngIf="getMaterialFormControls.date.errors.required">
                    Bitte <strong>Datum</strong> eingeben
                  </div>
                </div>
              </mat-form-field>
            </fieldset>

            <fieldset class="form-group">
              <mat-form-field>
                <input
                  matInput
                  formControlName="material"
                  placeholder="Material auswählen"
                  [matAutocomplete]="auto"
                  required
                  [ngClass]="{
                    'is-invalid':
                      submitted && getMaterialFormControls.material.errors
                  }"
                />
                <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
                  <mat-option
                    *ngFor="let option of filteredOptions | async"
                    [value]="option"
                  >
                    {{ option }}
                  </mat-option>
                </mat-autocomplete>

                <div
                  *ngIf="submitted && getMaterialFormControls.material.errors"
                  class="invalid-feedback"
                >
                  <div *ngIf="getMaterialFormControls.material.errors.required">
                    Bitte <strong>Material</strong> eingeben
                  </div>
                </div>
              </mat-form-field>
            </fieldset>

            <fieldset class="form-group">
              <mat-form-field>
                <input
                  matInput
                  type="number"
                  formControlName="amount"
                  placeholder="Anzahl"
                  required
                  [ngClass]="{
                    'is-invalid':
                      submitted && getMaterialFormControls.amount.errors
                  }"
                />
                <div
                  *ngIf="submitted && getMaterialFormControls.amount.errors"
                  class="invalid-feedback"
                >
                  <div *ngIf="getMaterialFormControls.amount.errors.required">
                    Bitte <strong>Anzahl</strong> eingeben
                  </div>
                </div>
              </mat-form-field>
            </fieldset>

            <fieldset class="form-group">
              <mat-form-field appearance="fill">
                <mat-label>Einheit auswählen</mat-label>
                <mat-select
                  formControlName="unit"
                  [ngClass]="{
                    'is-invalid':
                      submitted && getMaterialFormControls.unit.errors
                  }"
                >
                  <mat-option *ngFor="let unit of units" [value]="unit.value">
                    {{ unit.viewValue }}
                  </mat-option>
                </mat-select>
                <div
                  *ngIf="submitted && getMaterialFormControls.unit.errors"
                  class="invalid-feedback"
                >
                  <div *ngIf="getMaterialFormControls.unit.errors.required">
                    Bitte <strong>Einheit</strong> auswählen
                  </div>
                </div>
              </mat-form-field>
            </fieldset>
          </form>
        </div>

        <div *ngIf="selectedCategory === eCategory.note">
          <form
            id="note-form"
            formGroup="noteForm"
            #documentNoteForm="ngForm"
            (ngSubmit)="onSubmit()"
          >
            <fieldset class="form-group">
              <mat-form-field>
                <input
                  matInput
                  [matDatepicker]="picker"
                  placeholder="Datum wählen"
                  id="date"
                  name="date"
                  formControlName="date"
                  (click)="picker.open()"
                  required
                  [ngClass]="{
                    'is-invalid': submitted && getNoteFormControls.date.errors
                  }"
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="picker"
                ></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
                <div
                  *ngIf="submitted && getNoteFormControls.date.errors"
                  class="invalid-feedback"
                >
                  <div *ngIf="getNoteFormControls.date.errors.required">
                    Bitte <strong>Datum</strong> eingeben
                  </div>
                </div>
              </mat-form-field>
            </fieldset>

            <fieldset class="form-group">
              <mat-form-field>
                <mat-label>Notiz</mat-label>
                <textarea
                  matInput
                  cdkTextareaAutosize
                  #autosize="cdkTextareaAutosize"
                  cdkAutosizeMinRows="1"
                  cdkAutosizeMaxRows="5"
                  formControlName="description"
                ></textarea>
              </mat-form-field>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
